<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Welcome to Benfei VCF</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  :root {
    --neon: #39ff14;        /* neon green */
    --dark: #0a0a0a;
    --text: #e6ffe6;
    --accent: #14ffec;      /* cyan accent */
    --warn: #ff6f61;        /* coral red */
  }
  body {
    margin: 0;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: radial-gradient(circle at top left, #001100, var(--dark));
    font-family: 'Segoe UI', Roboto, sans-serif;
    color: var(--text);
    position: relative;
    overflow: hidden;
  }

  /* particles background */
  #particles-js {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: -1; /* keep it behind */
    background: radial-gradient(circle at top left, #001100, var(--dark));
  }

  .card {
    width: 95%;
    max-width: 440px;
    background: rgba(20, 20, 20, 0.9);
    border: 2px solid var(--neon);
    border-radius: 18px;
    box-shadow: 0 0 20px var(--neon), inset 0 0 15px rgba(57,255,20,0.2);
    padding: 28px;
    text-align: center;
    animation: glow 3s infinite alternate;
    transition: transform 0.3s ease;
    z-index: 1;
  }
  .card:hover { transform: scale(1.02); }
  @keyframes glow {
    from { box-shadow: 0 0 20px var(--neon), inset 0 0 10px rgba(57,255,20,0.15); }
    to { box-shadow: 0 0 40px var(--neon), inset 0 0 25px rgba(57,255,20,0.3); }
  }
  h1 {
    font-size: 24px;
    margin-bottom: 8px;
    color: var(--neon);
    text-shadow: 0 0 10px var(--neon);
  }
  p { margin: 6px 0 20px; font-size: 14px; color: #b3ffb3; }
  
  /* Counter styles */
  .counter {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 15px 0;
    padding: 10px;
    background: rgba(0, 30, 0, 0.4);
    border-radius: 10px;
    border: 1px solid var(--neon);
  }
  .counter i {
    margin-right: 10px;
    color: var(--accent);
  }
  .counter span {
    font-weight: bold;
    color: var(--neon);
    font-size: 18px;
  }
  
  input {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border-radius: 8px;
    border: 1px solid var(--neon);
    background: #111;
    color: var(--text);
    transition: all 0.3s ease;
  }
  input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 8px var(--accent);
  }
  button {
    width: 100%;
    padding: 12px;
    margin-top: 8px;
    border-radius: 8px;
    border: none;
    background: var(--neon);
    color: var(--dark);
    font-weight: 700;
    font-size: 15px;
    cursor: pointer;
    transition: background 0.3s, transform 0.2s;
  }
  button:hover { background: var(--accent); transform: translateY(-2px); }
  .msg { margin-top: 14px; font-size: 14px; min-height: 18px; }
  .wtap {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-top: 16px;
    text-decoration: none;
    color: var(--accent);
    font-weight: 600;
    border: 1px solid var(--accent);
    padding: 10px 14px;
    border-radius: 8px;
    transition: all 0.3s;
  }
  .wtap:hover { background: var(--accent); color: var(--dark); }
  .small { font-size: 12px; margin-top: 10px; color: #aaffaa; }
  i { margin-right: 6px; }
</style>
</head>
<body>
  <!-- particles container -->
  <div id="particles-js"></div>

  <div class="card">
    <h1><i class="fas fa-address-card"></i> Welcome to Benfei VCF</h1>
    <p><i class="fas fa-info-circle"></i> Upload your contact safely. If your number already exists, you'll be notified</p>
    
    <!-- Live counter display -->
    <div class="counter">
      <i class="fas fa-users"></i>
      <span id="contactCount">Loading...</span> contacts in our database
    </div>

    <form id="frm" onsubmit="return false">
      <input id="name" placeholder="Full Name" autocomplete="name">
      <input id="phone" placeholder="Phone Number (e.g. +234xxx...)" autocomplete="tel" required>
      <button id="submitBtn"><i class="fas fa-upload"></i> Upload Contact</button>
      <button onclick="location.href='https://chat.whatsapp.com/FSkISjIYnfhCFCvlMiuE26?mode=ems_copy_c'"><i class="fas fa-whatsapp" ></i> Join Whatsapp Group</button>
    </form>

    <div class="msg" id="msg"></div>

    <a id="whatsapp" class="wtap" target="_blank" href="https://whatsapp.com/channel/0029Vay16NVJENy6op6dBV3B">
      <i class="fab fa-whatsapp"></i> Follow Our WhatsApp Channel
    </a>
    <a id="whatsapp" class="wtap" target="_blank" href="https://www.youtube.com/@benfeitech">
      <i class="fab fa-youtube"></i> Subscribe To YouTube Channel 
    </a>
    <div class="small"><i class="fas fa-lock"></i> Your data is private and secure.</div>
  </div>

<script>
const msgEl = document.getElementById('msg');
const btn = document.getElementById('submitBtn');
const contactCountEl = document.getElementById('contactCount');

// Function to update the contact counter
async function updateContactCounter() {
  try {
    const response = await fetch('/api/count');
    const data = await response.json();
    
    if (data.count !== undefined) {
      contactCountEl.textContent = data.count.toLocaleString();
    } else {
      contactCountEl.textContent = 'Error';
      console.error('Unexpected response format:', data);
    }
  } catch (error) {
    console.error('Failed to fetch contact count:', error);
    contactCountEl.textContent = 'Error';
  }
}

// Initial counter update
updateContactCounter();

// Update counter every 30 seconds
setInterval(updateContactCounter, 30000);

function show(msg, color){
  msgEl.textContent = msg;
  msgEl.style.color = color || '#39ff14';
}

function normalizePhone(s){
  let plus = s.startsWith('+') ? '+' : '';
  return plus + s.replace(/\D/g,'');
}

document.getElementById('frm').addEventListener('submit', async () => {
  btn.disabled = true;
  show('Sending...');
  const name = document.getElementById('name').value.trim();
  const phone = normalizePhone(document.getElementById('phone').value.trim());
  if (!phone) { show('Please enter phone number', '#ff6f61'); btn.disabled=false; return; }
  try {
    const res = await fetch('/api/upload', {
      method:'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ name, phone })
    });
    const data = await res.json();
    if (data.exists) {
      show('⚠️ Phone number already exists.', '#ff6f61');
    } else if (data.success) {
      show('✅ Number uploaded successfully. Click the button above☝️ to join WhatsApp group.', 'lime');
      document.getElementById('name').value='';
      document.getElementById('phone').value='';
      
      // Update the counter after successful upload
      updateContactCounter();
    } else {
      show(data.error || 'Unexpected error.', '#ff6f61');
    }
  } catch (e) {
    console.error(e);
    show('Network error. Try again.', '#ff6f61');
  } finally {
    btn.disabled = false;
  }
});
</script>

<!-- particles.js library -->
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
particlesJS("particles-js", {
  particles: {
    number: { value: 120, density: { enable: true, value_area: 800 } },
    color: { value: ["#39ff14", "#14ffec"] }, // neon green + cyan
    shape: { type: "circle" },
    opacity: { value: 1, random: false }, // solid
    size: { value: 4, random: true },
    line_linked: {
      enable: true,
      distance: 150,
      color: "#14ffec",
      opacity: 0.9,
      width: 2
    },
    move: {
      enable: true,
      speed: 2.5,
      random: true,
      out_mode: "out"
    }
  },
  interactivity: {
    detect_on: "canvas",
    events: {
      onhover: { enable: true, mode: "repulse" },
      onclick: { enable: true, mode: "push" },
      resize: true
    },
    modes: {
      repulse: { distance: 120, duration: 0.4 },
      push: { particles_nb: 5 }
    }
  },
  retina_detect: true
});

// extra CSS glow effect
const style = document.createElement("style");
style.innerHTML = `
  #particles-js canvas {
    filter: drop-shadow(0 0 6px #39ff14)
            drop-shadow(0 0 12px #14ffec);
  }
`;
document.head.appendChild(style);
</script>

</body>
</html>
